name: Deploy Crawler
on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Deploy with Docker Compose
        working-directory: ./crawler-challenge
        run: |
          echo "ğŸš€ ë°°í¬ ì‹œì‘: ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ìµœì‹  ì½”ë“œ ë¹Œë“œ"
          
          # 1. ìµœì‹  ì½”ë“œë¡œ ì´ë¯¸ì§€ ë‹¤ì‹œ ë¹Œë“œ (ìºì‹œ í™œìš©)
          docker compose build
          
          # 2. ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (ë³€ê²½ëœ ë¶€ë¶„ë§Œ ê°ì§€í•´ì„œ êµì²´í•¨)
          # -d: ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
          docker compose up -d
          
          # 3. ë¶ˆí•„ìš”í•œ ì´ë¯¸ì§€ ì •ë¦¬ (ìš©ëŸ‰ í™•ë³´)
          docker image prune -f

      - name: Health Check (ìƒì¡´ í™•ì¸)
        working-directory: ./crawler-challenge
        run: |
          sleep 5
          docker compose ps
